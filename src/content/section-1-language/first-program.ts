import type { Chapter } from '../types'

export default {
  id: 'first-program',
  title: 'Первая программа',
  description: 'Hello World и анатомия программы на C',
  blocks: [
    {
      type: 'prose',
      markdown: `# Первая программа

Традиционно изучение любого языка программирования начинается с программы «Hello, World!». Эту традицию заложили именно авторы C — Брайан Керниган и Деннис Ритчи — в своей книге 1978 года.

Давайте напишем эту программу и разберём каждую строку.`,
    },
    {
      type: 'code',
      language: 'c',
      code: `#include <stdio.h>

int main(void)
{
    printf("Hello, World!\\n");
    return 0;
}`,
      filename: 'hello.c',
      highlightLines: [1, 3, 5, 6],
    },
    {
      type: 'output',
      content: 'Hello, World!',
      prompt: '$ gcc hello.c -o hello && ./hello',
    },
    {
      type: 'prose',
      markdown: `## Построчный разбор

Разберём каждую строку этой программы:

### Строка 1: \`#include <stdio.h>\`

Это **директива препроцессора**. Символ \`#\` означает, что это команда для препроцессора — специальной фазы компиляции, которая обрабатывает текст исходного кода до собственно компиляции.

\`#include <stdio.h>\` говорит: «вставь сюда содержимое файла \`stdio.h\`». Этот заголовочный файл содержит объявления функций стандартного ввода-вывода, включая \`printf\`.

- Угловые скобки \`< >\` означают, что файл ищется в системных директориях
- Кавычки \`" "\` использовались бы для пользовательских заголовочных файлов

### Строка 3: \`int main(void)\`

Это **объявление функции \`main\`** — точки входа в программу. Когда вы запускаете программу, операционная система вызывает именно эту функцию.

- \`int\` — тип возвращаемого значения (целое число)
- \`main\` — имя функции (зарезервированное)
- \`(void)\` — функция не принимает аргументов

### Строка 4: \`{\`

Открывающая фигурная скобка — начало тела функции.

### Строка 5: \`printf("Hello, World!\\n");\`

Вызов функции \`printf\` (print formatted) из стандартной библиотеки. Она выводит текст в стандартный поток вывода (обычно — терминал).

- \`"Hello, World!\\n"\` — строковый литерал
- \`\\n\` — управляющая последовательность (escape-символ), обозначающая перевод строки
- Точка с запятой \`;\` завершает оператор

### Строка 6: \`return 0;\`

Возвращает значение \`0\` операционной системе. По соглашению:
- \`0\` означает успешное завершение
- Любое другое значение — ошибку

### Строка 7: \`}\`

Закрывающая фигурная скобка — конец тела функции.`,
    },
    {
      type: 'note',
      variant: 'info',
      title: 'Зачем return 0?',
      markdown:
        'Начиная со стандарта C99, если в функции `main` отсутствует `return`, компилятор неявно добавляет `return 0;`. Однако хорошей практикой считается писать `return 0;` явно — это делает код более читаемым и совместимым со старыми стандартами.',
    },
    {
      type: 'diagram',
      component: 'CompilationPipeline',
      props: {
        stages: [
          { name: 'hello.c', description: 'Исходный код' },
          { name: 'Препроцессор', description: '#include, #define' },
          { name: 'Компилятор', description: 'Ассемблерный код' },
          { name: 'Ассемблер', description: 'Объектный файл' },
          { name: 'Линковщик', description: 'Подключение библиотек' },
          { name: 'hello', description: 'Исполняемый файл' },
        ],
      },
      caption:
        'Путь от исходного кода до исполняемого файла. Подробнее — в главе «Компиляция».',
    },
    {
      type: 'prose',
      markdown: `## Компиляция и запуск

Чтобы запустить программу на C, её нужно сначала **скомпилировать** — превратить текстовый исходный код в машинный код, который понимает процессор.

Самый распространённый компилятор — **GCC** (GNU Compiler Collection):`,
    },
    {
      type: 'code',
      language: 'bash',
      code: `# Компиляция: hello.c -> hello (исполняемый файл)
gcc hello.c -o hello

# Запуск
./hello`,
      filename: 'terminal',
    },
    {
      type: 'output',
      content: 'Hello, World!',
      prompt: '$ ./hello',
    },
    {
      type: 'prose',
      markdown: `Разберём команду компиляции:
- \`gcc\` — вызов компилятора
- \`hello.c\` — имя исходного файла
- \`-o hello\` — флаг \`-o\` (output) задаёт имя выходного файла

Если не указать \`-o\`, GCC создаст файл с именем \`a.out\` (исторически — «assembler output»).`,
    },
    {
      type: 'note',
      variant: 'warning',
      title: 'Распространённые ошибки',
      markdown: `Если программа не компилируется, проверьте:
- Не забыли ли вы точку с запятой \`;\` в конце операторов
- Правильно ли написано \`#include <stdio.h>\` (без опечаток)
- Закрыты ли все фигурные скобки \`{ }\`
- Есть ли у вас установленный компилятор (попробуйте \`gcc --version\`)`,
    },
    {
      type: 'prose',
      markdown: `## Управляющие последовательности

В строке \`"Hello, World!\\n"\` мы использовали \`\\n\` для перевода строки. C поддерживает множество управляющих последовательностей:

| Последовательность | Значение |
|-------------------|----------|
| \`\\n\` | Перевод строки (newline) |
| \`\\t\` | Табуляция |
| \`\\\\\` | Обратная косая черта |
| \`\\"\` | Двойная кавычка |
| \`\\'\` | Одинарная кавычка |
| \`\\0\` | Нулевой символ (конец строки) |
| \`\\r\` | Возврат каретки |
| \`\\a\` | Звуковой сигнал |`,
    },
    {
      type: 'code',
      language: 'c',
      code: `#include <stdio.h>

int main(void)
{
    printf("Имя:\\tАлексей\\n");
    printf("Город:\\tМосква\\n");
    printf("Путь: C:\\\\Users\\\\alexey\\n");
    printf("Он сказал: \\"Привет!\\"\\n");
    return 0;
}`,
      filename: 'escape.c',
    },
    {
      type: 'output',
      content: `Имя:\tАлексей
Город:\tМосква
Путь: C:\\Users\\alexey
Он сказал: "Привет!"`,
      prompt: '$ gcc escape.c -o escape && ./escape',
    },
    {
      type: 'prose',
      markdown: `## Вариации main

Вы можете встретить несколько способов объявления \`main\`:

\`\`\`c
// Стандартный способ (без аргументов)
int main(void) { ... }

// С аргументами командной строки
int main(int argc, char *argv[]) { ... }

// Устаревший стиль (K&R) — НЕ используйте
main() { ... }
\`\`\`

Мы пока будем использовать \`int main(void)\`. К аргументам командной строки (\`argc\`, \`argv\`) вернёмся позже.`,
    },
    {
      type: 'note',
      variant: 'tip',
      title: 'void vs пустые скобки',
      markdown:
        'В C есть важное различие: `int main(void)` явно говорит «функция не принимает аргументов», а `int main()` означает «функция принимает неопределённое число аргументов» (в C, но не в C++!). Всегда используйте `(void)` для пустого списка параметров.',
    },
    {
      type: 'prose',
      markdown: `## Комментарии

Комментарии — текст, который компилятор игнорирует. Они нужны для пояснения кода:`,
    },
    {
      type: 'code',
      language: 'c',
      code: `#include <stdio.h>

/*
 * Многострочный комментарий:
 * Эта программа выводит приветствие.
 * Автор: студент
 */
int main(void)
{
    // Однострочный комментарий (доступен начиная с C99)
    printf("Привет!\\n");  // Комментарий в конце строки
    return 0;
}`,
      filename: 'comments.c',
    },
    {
      type: 'exercise',
      title: 'Модифицируйте Hello World',
      description: `Напишите программу, которая выводит:
- Ваше имя
- Ваш город
- Текущий год

Каждый элемент — на отдельной строке. Используйте одну функцию \`printf\` с управляющими последовательностями \`\\n\`.

Пример ожидаемого вывода:
\`\`\`
Имя: Алексей
Город: Москва
Год: 2024
\`\`\``,
      hints: [
        'Используйте \\n внутри строки для перевода строки',
        'Можно вызвать printf один раз с несколькими \\n, или несколько раз',
        'Не забудьте #include <stdio.h>',
      ],
      solution: `#include <stdio.h>

int main(void)
{
    printf("Имя: Алексей\\nГород: Москва\\nГод: 2024\\n");
    return 0;
}`,
      solutionLanguage: 'c',
    },
    {
      type: 'exercise',
      title: 'ASCII-арт',
      description: `Напишите программу, которая выводит простой «домик» из символов:

\`\`\`
   /\\
  /  \\
 /    \\
+------+
|      |
|      |
+------+
\`\`\`

Подсказка: обратная косая черта \`\\\` — это управляющий символ, поэтому для вывода одного \`\\\` нужно написать \`\\\\\`.`,
      hints: [
        'Для вывода символа \\ используйте \\\\',
        'Можно использовать несколько вызовов printf, по одному на строку',
        'Следите за количеством пробелов для выравнивания',
      ],
      solution: `#include <stdio.h>

int main(void)
{
    printf("   /\\\\\\n");
    printf("  /  \\\\\\n");
    printf(" /    \\\\\\n");
    printf("+------+\\n");
    printf("|      |\\n");
    printf("|      |\\n");
    printf("+------+\\n");
    return 0;
}`,
      solutionLanguage: 'c',
    },
  ],
} satisfies Chapter
